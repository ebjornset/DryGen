<script src="https://unpkg.com/mermaid@9.1.6/dist/mermaid.min.js"></script>
<script>
  // select <pre class="mermaid"> _and_ <pre><code class="language-mermaid">
  document
    .querySelectorAll("pre.mermaid, pre>code.language-mermaid")
    .forEach(($el) => {
      const $mermaidCode = $el.innerHTML;
      // if the second selector got a hit, reference the parent <pre>
      if ($el.tagName === "CODE") $el = $el.parentElement;
      // put the Mermaid contents in the expected <div class="mermaid">
      // plus keep the original contents in a nice <details>
      $el.outerHTML = `<div class="mermaid">${$mermaidCode}</div>
    <details>
      <summary>The Mermaid code behind the diagram</summary>
      <pre>${$mermaidCode}</pre>
    </details>`;
    });
</script>
